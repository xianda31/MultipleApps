<div *ngIf="loaded" class="container">

    <div class="col-md-6 text-end">
        <div class="row">
            <div class="col">
                <button class=" btn btn-outline-success btn-sm">
                    <i class=" bi-file-earmark-arrow-up-fill"></i>
                    <a [href]="fileUrl" style="text-decoration: none; color: var(--bs-success);"
                        download="bilan.txt">export.txt</a>
                </button>
            </div>
            <div class="col">
                <button class=" btn btn-outline-success btn-sm" (click)="fileInput.click()">
                    <i class=" bi-file-earmark-arrow-down-fill"></i>
                    import.txt</button>
                <input #fileInput type="file" style="display:none" class="form-control form-control-sm text-end"
                    (change)="onInput($event)">
            </div>
            <div class="col">
                <button class=" btn btn-outline-success btn-sm" (click)="save_balance_sheets()">
                    <i class="bi-cloud-arrow-up-fill"></i>
                    sauvegarder</button>
            </div>
        </div>
    </div>
    <div class="card mt-5">
        <div class="card-header">
            <div class="row align-items-center">
                <div class="col-auto">
                    <h5> b ilan de l'exercice </h5>
                </div>
                <div class="col-auto">
                    <select [(ngModel)]="selected_season" (ngModelChange)="select_sheet()" type="text"
                        class="form-control" placeholder="saison">
                        <option *ngFor="let season of seasons" [value]="season" [selected]="season === selected_season">
                            {{season}}
                        </option>
                    </select>
                </div>
                <div *ngIf="selected_season === current_season" class="col-auto">
                    <button class="btn btn-outline-success btn-sm" (click)="update_balance_sheet_figures()">
                        <i class="fs-5 bi-gear"></i>
                    </button>
                </div>
            </div>
        </div>
        <div *ngIf="loaded" class="card-body">
            <div class="row">
                <div class="col-6">
                    <!-- <div class="card"> -->
                    <!-- <div class="card-body"> -->
                    <table class="table table-sm table-borderless table-responsive text-end fs-5 align-middle">
                        <thead>
                            <tr class="table-primary">
                                <th width="30%" class="text-start">ACTIF </th>
                                <th width="10%">var.</th>
                                <th width="30%"> {{ current_balance_sheet.season }}</th>
                                <th width="30%" class="table-secondary fs-5"> {{ prev_balance_sheet.season }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="text-start">STOCKS</td>
                                <td></td>
                                <td>{{current_balance_sheet.assets.stock | number:nbr_trunc:'fr'}}</td>
                                <td class="table-secondary fs-5">{{prev_balance_sheet.assets.stock |
                                    number:nbr_trunc:'fr'}}
                                </td>
                            </tr>
                            <tr>
                                <td class="text-start">CREANCES</td>
                                <td></td>
                                <td>{{current_balance_sheet.assets.receivables | number:nbr_trunc:'fr'}}</td>
                                <td class="table-secondary fs-5">{{prev_balance_sheet.assets.receivables |
                                    number:nbr_trunc:'fr'}}</td>
                            </tr>
                            <tr>
                                <td>&#8205;</td>
                                <td>&#8205;</td>
                                <td>&#8205;</td>
                                <td class="table-secondary fs-5">&#8205;</td>
                            </tr>

                            <tr>
                                <td class="text-start">TRESORERIE</td>
                                <td>{{liquidities_evolution | number:nbr_trunc:'fr'}}</td>
                                <td>
                                    {{total_current_liquidities() | number:nbr_trunc:'fr'}} </td>
                                <td class="table-secondary fs-5">{{total_previous_liquidities() |
                                    number:nbr_trunc:'fr'}}
                                </td>
                            </tr>
                            <tr class="fw-light fs-6">
                                <td>Ã©pargne</td>
                                <td>{{get_liquidity_evolution('savings')| number:nbr_trunc:'fr'}}</td>
                                <td> {{current_balance_sheet.assets.liquidities.savings | number:nbr_trunc:'fr'}}</td>
                                <td class="table-secondary fs-5"> {{prev_balance_sheet.assets.liquidities.savings
                                    |
                                    number:nbr_trunc:'fr'}}</td>
                            </tr>
                            <tr class="fw-light fs-6">
                                <td>banque</td>
                                <td>{{get_liquidity_evolution('bank')| number:nbr_trunc:'fr'}}</td>
                                <td> {{current_balance_sheet.assets.liquidities.bank | number:nbr_trunc:'fr'}}</td>
                                <td class="table-secondary fs-5"> {{prev_balance_sheet.assets.liquidities.bank}}
                                </td>
                            </tr>
                            <tr class="fw-light fs-6">
                                <td>caisse</td>
                                <td>{{get_liquidity_evolution('cash')| number:nbr_trunc:'fr'}}</td>
                                <td> {{current_balance_sheet.assets.liquidities.cash | number:nbr_trunc:'fr'}}</td>

                                <td class="table-secondary fs-5"> {{prev_balance_sheet.assets.liquidities.cash |
                                    number:nbr_trunc:'fr'}}</td>
                            </tr>

                            <tr class="table-primary fw-bold">
                                <td class="text-start ">TOTAL ACTIF</td>
                                <td>{{get_assets_evolution() | number:nbr_trunc:'fr'}}</td>
                                <td> {{total_current_assets()| number:nbr_trunc:'fr'}} </td>

                                <td class="table-secondary fs-5">{{total_previous_assets()|
                                    number:nbr_trunc:'fr'}}</td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- </div> -->
                    <!-- </div> -->
                </div>

                <!-- PASSIF -->
                <div class="col-6">
                    <table class="table table-sm table-borderless table-responsive text-end fs-5">
                        <thead>
                            <tr class="table-primary">
                                <th width="70%" class="text-start">PASSIF </th>
                                <th width="30%">
                                    {{ current_balance_sheet.season }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="text-start">REPORT A NOUVEAU</td>
                                <td>{{current_balance_sheet.liabilities.balance_forward | number:nbr_trunc:'fr'}}</td>
                            </tr>
                            <tr>
                                <td class="text-start">CHARGES ENGAGEES</td>
                                <td>{{current_balance_sheet.liabilities.accrued_expenses | number:nbr_trunc:'fr'}}</td>
                            </tr>
                            <tr>
                                <td>&#8205;</td>
                                <td>&#8205;</td>
                            </tr>
                            <tr class="table-primary fw-bold">
                                <td class="text-start ">EXERCICE
                                    {{deficit?'DEFICITAIRE':'BENEFICIAIRE'}}</td>
                                <td>{{profit_and_loss_result | number:nbr_trunc:'fr'}}</td>
                            </tr>
                            <tr class="fw-light fs-5">
                                <td>&#8205;</td>
                                <td>&#8205;</td>
                            </tr>
                            <tr class="fw-light fs-5">
                                <td>&#8205;</td>
                                <td>&#8205;</td>
                            </tr>
                            <tr class="fw-light fs-5">
                                <td>&#8205;</td>
                                <td>&#8205;</td>
                            </tr>
                            <tr class="table-primary fw-bold">
                                <td class="text-start ">TOTAL PASSIF</td>
                                <td> {{get_total_current_liabilities() | number:nbr_trunc:'fr'}} </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>