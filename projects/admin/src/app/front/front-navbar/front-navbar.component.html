<nav class="navbar navbar-expand-md navbar-dark text-white d-flex align-items-center">
  <div class="container-fluid h-100 d-flex align-items-center">
    <a class="navbar-brand d-flex align-items-center position-relative" routerLink="/home">Accueil</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu"
      aria-controls="sidebarMenu">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse d-none d-md-flex align-items-center position-relative">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
     
        <!-- test addmenu -->
        <ng-container *ngIf="active_menu_editor"><ng-container *ngTemplateOutlet="testmenu"></ng-container></ng-container>


        <li ngbDropdown class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" ngbDropdownToggle id="clubDropdown">Le Club</a>
          <ul ngbDropdownMenu class="dropdown-menu" aria-labelledby="clubDropdown">
            <li><a class="dropdown-item" routerLink="club/acteurs">Les acteurs</a></li>
            <li><a class="dropdown-item" routerLink="club/documents">Documents</a></li>
            <li><a class="dropdown-item" routerLink="club/bureau">Le bureau</a></li>
            <li><a class="dropdown-item" routerLink="club/historique">L'historique</a></li>
            <li><a class="dropdown-item" routerLink="contacts">Nous contacter</a></li>
          </ul>
        </li>
        <li ngbDropdown class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" ngbDropdownToggle id="ecoleDropdown">L'école</a>
          <ul ngbDropdownMenu class="dropdown-menu" aria-labelledby="ecoleDropdown">
            <li><a class="dropdown-item" routerLink="école/cours">Cours</a></li>
          </ul>
        </li>
        <li ngbDropdown class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" ngbDropdownToggle id="tournoisDropdown">Les tournois</a>
          <ul ngbDropdownMenu class="dropdown-menu" aria-labelledby="tournoisDropdown">
            <li><a class="dropdown-item" routerLink="tournaments/next">Tournois de régularité ouverts</a></li>
            <li><a class="dropdown-item" routerLink="tournaments/autres_rdv">Autres rendez-vous</a></li>
            <li><a class="dropdown-item" routerLink="tournaments/resultats_ffb">FFB : résultats récents</a></li>
            <li><a class="dropdown-item" href="https://www.bridgeplus.com/nos-simultanes/resultats/?res=sim"
                target="_blank" rel="noopener">Roy René : résultats récents</a></li>
          </ul>
        </li>

        <li *ngIf="logged_member$ | async as member" ngbDropdown class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" ngbDropdownToggle id="achatsDropdown">Mes achats</a>
          <ul ngbDropdownMenu class="dropdown-menu" aria-labelledby="achatsDropdown">
            <li><a class="dropdown-item" routerLink="achats/historique">Mon relevé</a></li>
            <li><a class="dropdown-item" routerLink="achats/carte">Mes droits de table</a>
            </li>
          </ul>
        </li>

        <li *ngIf="logged_member$ | async as member" class="nav-item"><a class="nav-link" routerLink="albums">Les
            albums</a></li>

        <li *ngIf="user_accreditation && user_accreditation.level > 0" class="nav-item">
          <a class="nav-link" routerLink="../back">Back office</a>
        </li>

        <li *ngIf="!(logged_member$ | async)" class="nav-item ">
          <a class="nav-link" routerLink="connexion">Espace membre</a>
        </li>

        <li *ngIf="logged_member$ | async as member" ngbDropdown class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" ngbDropdownToggle id="userDropdown">
            <img *ngIf="member.has_avatar" [src]="avatar$ | async" alt="avatar" class="rounded-circle"
              style="width:28px; height:28px; max-width:28px; max-height:28px; object-fit:cover">
            {{member.firstname}}</a>
          <ul ngbDropdownMenu class="dropdown-menu" aria-labelledby="userDropdown">
            <li><a class="dropdown-item" routerLink="my_settings">mes préférences</a></li>
            <li><a class="dropdown-item" routerLink="ffb_dashboard">mon tableau de bord FFB</a></li>
            <li><a class="dropdown-item" (click)="signOut()"><i class="bi bi-box-arrow-right"></i> Déconnexion</a></li>
          </ul>
        </li>
      </ul>
    </div>

  <!-- Sidebar for mobile -->
    <div class="offcanvas offcanvas-start d-md-none bg-white text-dark align-items-start " tabindex="-1"
      id="sidebarMenu" aria-labelledby="sidebarMenuLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="sidebarMenuLabel">BCSTO</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
  
        <ul class="navbar-nav">

          <li *ngIf="!(logged_member$ | async)" class="nav-item" data-bs-dismiss="offcanvas">
            <a class="nav-link" routerLink="connexion">Espace membre</a>
          </li>

          <li *ngIf="logged_member$ | async as member" ngbDropdown class="nav-item dropdown mb-2">
            <a class="nav-link dropdown-toggle" ngbDropdownToggle id="userDropdownMobile">{{member.firstname}}</a>
            <ul ngbDropdownMenu class="dropdown-menu" aria-labelledby="userDropdownMobile">
              <li><a class="dropdown-item" routerLink="ffb_dashboard">FFB : tableau de bord</a></li>
              <li><a class="dropdown-item" (click)="signOut()"><i class="bi bi-box-arrow-right"></i> Déconnexion</a>
              </li>
            </ul>
          </li>

          <li ngbDropdown class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" ngbDropdownToggle id="clubDropdownMobile">Le Club</a>
            <ul ngbDropdownMenu class="dropdown-menu" aria-labelledby="clubDropdownMobile">
              <li><a class="dropdown-item" routerLink="club/acteurs" data-bs-dismiss="offcanvas">Les acteurs</a></li>
              <li><a class="dropdown-item" routerLink="club/documents" data-bs-dismiss="offcanvas">Documents</a></li>
              <li><a class="dropdown-item" routerLink="club/bureau" data-bs-dismiss="offcanvas">Le bureau</a></li>
              <li><a class="dropdown-item" routerLink="club/historique" data-bs-dismiss="offcanvas">L'historique</a>
              <li><a class="dropdown-item" routerLink="contacts" data-bs-dismiss="offcanvas">Nous contacter</a>
              </li>
            </ul>
          </li>
          <li ngbDropdown class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" ngbDropdownToggle id="ecoleDropdownMobile">L'école</a>
            <ul ngbDropdownMenu class="dropdown-menu" aria-labelledby="ecoleDropdownMobile">
              <li><a class="dropdown-item" routerLink="école/cours" data-bs-dismiss="offcanvas">Cours</a></li>
            </ul>
          </li>
          <li ngbDropdown class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" ngbDropdownToggle id="tournoisDropdownMobile">Les tournois</a>
            <ul ngbDropdownMenu class="dropdown-menu" aria-labelledby="tournoisDropdownMobile">
              <li><a class="dropdown-item" routerLink="tournaments/next" data-bs-dismiss="offcanvas">Régularité à
                  venir</a></li>
              <li><a class="dropdown-item" routerLink="tournaments/resultats_ffb" data-bs-dismiss="offcanvas">FFB :
                  résultats récents</a></li>
              <li><a class="dropdown-item" href="https://www.bridgeplus.com/nos-simultanes/resultats/?res=sim"
                  target="_blank" rel="noopener">Roy René : résultats récents</a></li>
            </ul>
          </li>
          <li *ngIf="logged_member$ | async " ngbDropdown class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" ngbDropdownToggle id="achatsDropdownMobile">Mes achats</a>
            <ul ngbDropdownMenu class="dropdown-menu" aria-labelledby="achatsDropdownMobile">
              <li><a class="dropdown-item" routerLink="achats/historique" data-bs-dismiss="offcanvas">Mon relevé</a>
              </li>
              <li><a class="dropdown-item" routerLink="achats/carte" data-bs-dismiss="offcanvas">Mes droits de table</a>
              </li>
            </ul>
          </li>

          <li *ngIf="logged_member$ | async " class="nav-item"><a class="nav-link" routerLink="albums"
              data-bs-dismiss="offcanvas">Les albums</a></li>

          <li *ngIf=" user_accreditation && user_accreditation.level > 0" class="nav-item">
            <a class="nav-link" routerLink="../back" data-bs-dismiss="offcanvas">Back office</a>
          </li>

        </ul>
      </div>
    </div>

    <!-- Sandbox badge pushed to the far right inside navbar container -->
    <span *ngIf="sandboxMode" class="badge rounded-pill text-bg-warning ms-auto sandbox-badge" aria-label="Mode sandbox">
      SANDBOX
    </span>
  </div>
</nav>




<!-- Offcanvas moved inside app-connexion-menu component -->


<ng-template #testmenu>
  <ng-container *ngFor="let entry of menus | keyvalue">
    <ng-container *ngIf="entry.value.parent.position === NAVITEM_POSITION.NAVBAR">
      <!-- Dropdown parent only if it actually has children; otherwise fall back to a simple link -->
      <ng-container
  *ngIf="entry.value.parent.type === NAVITEM_TYPE.DROPDOWN && (entry.value.childs.length || 0) > 0; else simpleLink">
        <li class="nav-item dropdown ms-3" ngbDropdown>
          <button class="nav-link dropdown-toggle btn btn-link p-0" type="button" ngbDropdownToggle
            id="nav-{{ entry.key }}">
            {{ entry.value.parent.label }}
          </button>
          <div class="dropdown-menu" ngbDropdownMenu [attr.aria-labelledby]="'nav-' + entry.key"             >
            <button class="dropdown-item d-flex align-items-center gap-2" *ngFor="let child of entry.value.childs"
              type="button" [routerLink]= "child.path " >
              <span>{{ child.label }}</span>
            </button>
          </div>
        </li>
      </ng-container>
      <!-- Simple link parent (no dropdown) -->
      <ng-template #simpleLink>
        <li class="nav-item ms-3">
          <button class="nav-link btn btn-link p-0" type="button" [routerLink]= "entry.value.parent.path ">
            {{ entry.value.parent.label }}
          </button>
        </li>
      </ng-template>
    </ng-container>
  </ng-container>
</ng-template>