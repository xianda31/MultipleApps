<div class="container-fluid bg-light p-0 m-0 w-100" style="max-width:100vw;">
  <div class="d-flex d-inline align-items-start w-100 bg-dark px-2 pt-1 pb-1 position-relative">
    <!-- Mobile sidebar toggle button -->
    <button *ngIf="(logged_member$ | async)" class="btn btn-outline-secondary d-md-none text-center" type="button"
      data-bs-toggle="offcanvas" data-bs-target="#mobileSidebar" aria-controls="mobileSidebar">
      <i class="bi bi-list text-start"></i>
    </button>


    <span class="d-none d-md-inline logo-overlap" style="margin-right:0.5em;">
      <img src="admin.jpg" alt="BCSTO logo" class="me-1 logo-navbar"
        style="height:2.7em;max-height:56px;width:auto;display:block;" />
    </span>

    <span class="d-none d-md-inline fs-5 ms-1" style="padding-left:1em;">
      Bridge Club <span style="white-space:nowrap">Saint-Orens</span>
      - saison {{season}}
      <span class="badge bg-success" style="font-size: 0.6rem;">{{entries_nbr}}</span>
      <span *ngIf="!production_mode" class="badge bg-dark" style="font-size: 0.6rem;">dev</span>
    </span>

    <span class="d-sm-inline d-md-none fs-5 ms-1">BCSTO {{season}}</span>

    <!-- backdoor to front -->
    <div class="d-flex ms-auto align-items-end me-2">
      <span class=" ms-4 d-none d-sm-inline ">
        <a [routerLink]="'/front'">
          <i class="bi bi-door-open-fill "></i>
        </a>
      </span>
    </div>
  </div>

  <!-- Desktop navigation -->
  <nav class="navbar navbar-expand-md navbar-light bg-light shadow-sm d-none d-md-block w-100" style="padding-left:0;">
    <div class="navbar-collapse d-flex" style="padding-left:0;">
      <!-- <ul class="navbar-nav me-auto mb-md-0 mb-lg-0 align-items-start menu-sm-tight">
      </ul> -->
      <ul class="navbar-nav mb-md-0 mb-lg-0 mt-2 align-items-end" style="padding-left:0;">

        <li class="nav-item" *ngIf="accreditation_level >= accreditation_levels.Contributeur">
          <a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.FeesCollector">
            <i class="bi bi-card-checklist"></i>
            <span class="ms-1">Tournois</span>
          </a>
        </li>

        <li *ngIf="accreditation_level >= accreditation_levels.Contributeur" ngbDropdown [autoClose]="'inside'"
          class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" ngbDropdownToggle role="button">
            <i class="bi bi-cart"></i> <span class="ms-1">Boutique</span>
          </a>
          <ul ngbDropdownMenu class="dropdown-menu">
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.Shop">vente à adhérents</a></li>
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.Products">produits à la vente</a></li>
          </ul>
        </li>

        <li *ngIf="accreditation_level >= accreditation_levels.Contributeur" ngbDropdown [autoClose]="'inside'"
          class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" ngbDropdownToggle role="button">
            <i class="bi bi-people"></i>
            <span class="ms-1">Adhérents</span>
          </a>
          <ul ngbDropdownMenu class="dropdown-menu">
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.MembersDatabase">répertoire</a></li>
            <li *ngIf="accreditation_level >= accreditation_levels.Administrateur"><a class="dropdown-item"
                [routerLink]="BACK_ROUTE_PATHS.GameCardsEditor">cartes admission</a></li>
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.MemberSales">contrôles</a></li>
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.Competitions">compétitions</a></li>
          </ul>
        </li>


        <li *ngIf="accreditation_level >= accreditation_levels.Administrateur" ngbDropdown class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" ngbDropdownToggle role="button">
            <i class="bi bi-journal"></i> <span class="ms-1">Finance</span>
          </a>
          <ul ngbDropdownMenu class="dropdown-menu">
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.CashBoxStatus">état de caisse</a></li>
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.BooksEditor">écritures</a></li>
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.BooksOverview">synthèse</a></li>
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.BankReconciliation">rapprochement bancaire</a>
            </li>
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.ExpenseAndRevenue">résultats</a></li>
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.Balance">bilan</a></li>
          </ul>
        </li>

        <!-- Outils -->
        <li *ngIf="accreditation_level >= accreditation_levels.Systeme" ngbDropdown class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" ngbDropdownToggle role="button">
            <i class="bi bi-database-fill-gear"></i> <span class="ms-1">Outils</span>
          </a>
          <ul ngbDropdownMenu class="dropdown-menu">
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.BooksList">base de données</a></li>
            <li *ngIf="!production_mode"><a class="dropdown-item"
                [routerLink]="BACK_ROUTE_PATHS.BooksEditorFull">écriture</a></li>
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.GroupsList">droits d'accès</a></li>
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.SysConf">configuration</a></li>
            <li *ngIf="!production_mode"><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.RootVolume">données
                S3</a></li>
            <li *ngIf="!production_mode"><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.ImportExcel">import
                excel</a>
            </li>
            <li *ngIf="!production_mode"><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.CloneDB">clone DB</a>
            </li>
            <li *ngIf="!production_mode"><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.CloneS3">clone S3</a>
            </li>
          </ul>
        </li>

        <!-- site -->
        <li *ngIf="accreditation_level >= accreditation_levels.Editeur" ngbDropdown class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" ngbDropdownToggle role="button">
            <i class="bi bi-globe2"></i> <span class="ms-1">Site web</span>
          </a>
          <ul ngbDropdownMenu class="dropdown-menu">
            <!-- <li><a class="dropdown-item" routerLink="./site/thumbnails">vignettes</a></li> -->
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.UiConf">paramètres UI</a></li>
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.MenusEditor">les menus</a></li>
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.CMSWrapper">pages et datas</a></li>
            <li><a class="dropdown-item" routerLink="/front">aller sur le site</a></li>
          </ul>
        </li>
        <!-- communication -->
        <li *ngIf="accreditation_level >= accreditation_levels.Editeur" ngbDropdown class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" ngbDropdownToggle role="button">
            <i class="bi bi-globe2"></i> <span class="ms-1">Communication</span>
          </a>
          <ul ngbDropdownMenu class="dropdown-menu">
            <!-- <li><a class="dropdown-item" routerLink="./site/thumbnails">vignettes</a></li> -->
            <li><a class="dropdown-item" routerLink="./communication/assistance">
                Assistance
                <span class="badge bg-warning top-0 start-100 translate-middle"
                  style="font-size: 0.6rem;">{{assistances_nbr}}</span>
              </a></li>
            <li><a class="dropdown-item" routerLink="./communication/mailing">Mailing</a></li>
          </ul>
        </li>




        <li *ngIf="(logged_member$ | async) as member" class="nav-item dropdown ms-auto me-5" ngbDropdown>
          <a class="nav-link dropdown-toggle d-flex align-items-center" ngbDropdownToggle href="#">
            <ng-container *ngIf="member.has_avatar; else defaultIcon">
              <img [src]="avatar$ | async" alt="avatar" class="rounded-circle align-self-center"
                style="width:20px; height:20px; max-width:20px; max-height:20px; object-fit:cover;">
            </ng-container>
            <ng-template #defaultIcon>
              <i class="bi bi-person-circle align-self-center"></i>
            </ng-template>
            <span class="ms-1 align-self-center">{{ member.firstname }}</span>
          </a>
          <ul ngbDropdownMenu class="dropdown-menu">
            <li> <a class="dropdown-item" (click)="signOut()">
                <i class="bi bi-box-arrow-right"></i>
                Déconnexion
              </a></li>
          </ul>
        </li>

      </ul>
    </div>
  </nav>

  <!-- Mobile sidebar (offcanvas) -->
  <div class="offcanvas offcanvas-start d-md-none" tabindex="-1" id="mobileSidebar"
    aria-labelledby="mobileSidebarLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="mobileSidebarLabel">Back office</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body p-0">
      <ul class="navbar-nav menu-sm-tight">


        <!-- Copy of the navigation menu for mobile -->

        <!-- Tournoi (single item) -->
        <li class="nav-item" *ngIf="accreditation_level >= accreditation_levels.Contributeur">
          <a class="nav-link d-flex align-items-center" [routerLink]="BACK_ROUTE_PATHS.FeesCollector"
            data-bs-dismiss="offcanvas">
            <i class="bi bi-card-checklist"></i>
            <span class="ms-1">Tournois</span>
          </a>
        </li>

        <li *ngIf="accreditation_level >= accreditation_levels.Contributeur" class="nav-item">
          <div class="d-flex align-items-center">
            <span class="nav-link p-0 pe-2" style="cursor:pointer;" (click)="toggleMobileMenu('boutique')">
              <i class="bi bi-cart"></i> <span class="ms-1">Boutique</span>
            </span>
            <a class="nav-link dropdown-toggle p-0" (click)="toggleMobileMenu('boutique')" href="javascript:void(0)"
              style="width:2em;"></a>
          </div>
          <ul class="list-unstyled ps-4" [ngbCollapse]="!mobileMenus.boutique">
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.Shop" data-bs-dismiss="offcanvas">vente à adhérents</a>
            </li>
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.Products" data-bs-dismiss="offcanvas">produits à la
              vente</a></li>
          </ul>
        </li>
        <li *ngIf="accreditation_level >= accreditation_levels.Contributeur" class="nav-item">
          <div class="d-flex align-items-center">
            <span class="nav-link p-0 pe-2" style="cursor:pointer;" (click)="toggleMobileMenu('adherents')">
              <i class="bi bi-people"></i> <span class="ms-1">Adhérents</span>
            </span>
            <a class="nav-link dropdown-toggle p-0" (click)="toggleMobileMenu('adherents')" href="javascript:void(0)"
              style="width:2em;"></a>
          </div>
          <ul class="list-unstyled ps-4" [ngbCollapse]="!mobileMenus.adherents">
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.MembersDatabase" data-bs-dismiss="offcanvas">répertoire</a></li>
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.GameCardsEditor" data-bs-dismiss="offcanvas">cartes
              admission</a></li>
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.MemberSales" data-bs-dismiss="offcanvas">contrôles</a></li>
            <li><a class="dropdown-item" [routerLink]="BACK_ROUTE_PATHS.Competitions" data-bs-dismiss="offcanvas">compétitions</a>
            </li>
          </ul>
        </li>
        <li *ngIf="accreditation_level >= accreditation_levels.Administrateur" class="nav-item">
          <div class="d-flex align-items-center">
            <span class="nav-link p-0 pe-2" style="cursor:pointer;" (click)="toggleMobileMenu('finance')">
              <i class="bi bi-journal"></i> <span class="ms-1">Finance</span>
            </span>
            <a class="nav-link dropdown-toggle p-0" (click)="toggleMobileMenu('finance')" href="javascript:void(0)"
              style="width:2em;"></a>
          </div>
          <ul class="list-unstyled ps-4" [ngbCollapse]="!mobileMenus.finance">
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.CashBoxStatus" data-bs-dismiss="offcanvas">état de
                caisse</a></li>
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.BooksEditor" data-bs-dismiss="offcanvas">écritures
              </a></li>
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.BooksOverview" data-bs-dismiss="offcanvas">synthèse</a>
            </li>
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.BankReconciliation" data-bs-dismiss="offcanvas">rapprochement
                bancaire</a></li>
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.ExpenseAndRevenue" data-bs-dismiss="offcanvas">résultats</a>
            </li>
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.Balance" data-bs-dismiss="offcanvas">bilan</a></li>
          </ul>
        </li>
        <li *ngIf="accreditation_level >= accreditation_levels.Systeme" class="nav-item">
          <div class="d-flex align-items-center">
            <span class="nav-link p-0 pe-2" style="cursor:pointer;" (click)="toggleMobileMenu('outils')">
              <i class="bi bi-database-fill-gear"></i> <span class="ms-1">Outils</span>
            </span>
            <a class="nav-link dropdown-toggle p-0" (click)="toggleMobileMenu('outils')" href="javascript:void(0)"
              style="width:2em;"></a>
          </div>
          <ul class="list-unstyled ps-4" [ngbCollapse]="!mobileMenus.outils">
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.BooksList" data-bs-dismiss="offcanvas">base de
              données</a></li>
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.BooksEditorFull" data-bs-dismiss="offcanvas">écriture</a>
            </li>
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.GroupsList" data-bs-dismiss="offcanvas">droits d'accès</a>
            </li>
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.SysConf" data-bs-dismiss="offcanvas">configuration</a>
            </li>
            <li *ngIf="!production_mode"><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.ImportExcel"
              data-bs-dismiss="offcanvas">import excel</a></li>
            <li *ngIf="!production_mode"><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.CloneDB"
              data-bs-dismiss="offcanvas">clone DB</a></li>
          </ul>
        </li>
        <li *ngIf="accreditation_level >= accreditation_levels.Administrateur" class="nav-item">
          <div class="d-flex align-items-center">
            <span class="nav-link p-0 pe-2" style="cursor:pointer;" (click)="toggleMobileMenu('site')">
              <i class="bi bi-globe2"></i> <span class="ms-1">Site web</span>
            </span>
            <a class="nav-link dropdown-toggle p-0" (click)="toggleMobileMenu('site')" href="javascript:void(0)"
              style="width:2em;"></a>
          </div>
          <ul class="list-unstyled ps-4" [ngbCollapse]="!mobileMenus.site">
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.UiConf" data-bs-dismiss="offcanvas">paramètres UI</a></li>
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.MenusEditor" data-bs-dismiss="offcanvas">les menus</a></li>
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.CMSWrapper" data-bs-dismiss="offcanvas">pages et datas</a></li>

            <li><a class="nav-link" routerLink="/front" data-bs-dismiss="offcanvas">aller sur le site</a></li>
          </ul>
        </li>

        <!-- communication -->

        <li *ngIf="accreditation_level >= accreditation_levels.Administrateur" class="nav-item">
          <div class="d-flex align-items-center">
            <span class="nav-link p-0 pe-2" style="cursor:pointer;" (click)="toggleMobileMenu('communication')">
              <i class="bi bi-globe2"></i> <span class="ms-1">Communication</span>
            </span>
            <a class="nav-link dropdown-toggle p-0" (click)="toggleMobileMenu('communication')"
              href="javascript:void(0)" style="width:2em;"></a>
          </div>
          <ul class="list-unstyled ps-4" [ngbCollapse]="!mobileMenus.communication">
            <!-- <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.Snippets">vignettes</a></li> -->
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.Assistance" data-bs-dismiss="offcanvas">
                Assistance
                <span class="badge bg-warning top-0 start-100 translate-middle"
                  style="font-size: 0.6rem;">{{assistances_nbr}}</span>
              </a></li>
            <li><a class="nav-link" [routerLink]="BACK_ROUTE_PATHS.Mailing" data-bs-dismiss="offcanvas">Mailing</a></li>
          </ul>
        </li>


        <li *ngIf="(logged_member$ | async) " class="nav-item">
          <div class="d-flex align-items-center">
            <span class="nav-link p-0 pe-2" style="cursor:pointer;" (click)="toggleMobileMenu('user')">
              <i class="bi bi-person-circle"></i>
              <span class="ms-1">{{ (logged_member$ | async)?.firstname }}</span>
            </span>
            <a class="nav-link dropdown-toggle p-0" (click)="toggleMobileMenu('user')" href="javascript:void(0)"
              style="width:2em;"></a>
          </div>
          <ul class="list-unstyled ps-4" [ngbCollapse]="!mobileMenus.user">
            <li> <a class="nav-link" (click)="signOut()" data-bs-dismiss="offcanvas" style="cursor:pointer;">
                <i class="bi bi-box-arrow-right"></i>
                Déconnexion
              </a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>

</div>