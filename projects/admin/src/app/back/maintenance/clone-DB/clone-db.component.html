<div class="card mt-3">
    <h4 class="card-header text-center">DB clone ({{production_apid}} → {{sandbox_apid}})</h4>
    <div class="card-body">
        <div class="row g-2 align-items-end mb-3">
            <div class="col-12 col-md-8">
                <div class="text-muted small">Sélectionnez les tables à cloner et lancez l'action. Les tables de destination seront vidées puis recopiées.</div>
            </div>
            <div class="col-12 col-md-4 d-flex gap-2 justify-content-end">
                <button class="btn btn-outline-secondary" (click)="refreshTables()" [disabled]="started">Rafraîchir</button>
                <button class="btn btn-outline-info" (click)="refreshCountsLive()" [disabled]="started">Rafraîchir (live)</button>
                <button class="btn btn-primary" (click)="cloneSelected()" [disabled]="started">Cloner la sélection</button>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered table-sm align-middle">
                <thead>
                    <tr>
                        <th class="text-center" style="width: 48px;">Sel.</th>
                        <th>Production</th>
                        <th>Sandbox</th>
                        <th class="text-center" style="width: 160px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let table of production_tables; let i = index">
                        <td class="text-center"><input type="checkbox" [(ngModel)]="selected[i]"></td>
                        <td>
                            <code>{{ name(table.Table?.TableName ?? '') }}</code> ·
                            {{ table.Table?.ItemCount }} items ·
                            {{ table.Table?.TableSizeBytes | number: '1.0-0' }} bytes
                        </td>
                        <td>
                            <code>{{ name(sandbox_tables[i].Table?.TableName ?? '') }}</code> ·
                            {{ sandbox_tables[i].Table?.ItemCount }} items ·
                            {{ sandbox_tables[i].Table?.TableSizeBytes | number: '1.0-0' }} bytes
                        </td>
                        <td class="text-center">
                            <div class="d-flex flex-column gap-1">
                                <button class="btn btn-sm btn-primary" (click)="cloneTableAt(i)" [disabled]="started || rowCloning[i]">Cloner</button>
                                <div *ngIf="rowCloning[i]" class="small text-muted">en cours…</div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <hr class="my-2">
        <div class="text-muted small">
            Note: « Rafraîchir » utilise les métadonnées DescribeTable (rapide mais éventuellement approximatif),
            tandis que « Rafraîchir (live) » effectue un scan fort de chaque table (plus lent et consomme des RCU)
            pour afficher un nombre d’items exact au moment du clic. La taille (TableSizeBytes) n’est pas recalculée en mode live.
        </div>
    </div>
</div>